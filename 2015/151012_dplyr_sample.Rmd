---
title: "データフレームからランダムにデータを抽出したい"
author: "Shinya Uryu"
date: "2015年10月12日"
output: 
  md_document:
    variant: markdown_github
---

北のマエショリストこと（**面識もない私が勝手に呼んでいる**） id:WAFkw さんがこんな記事を書いていた。

http://wafdata.hatenablog.com/entry/2015/09/28/215608

手持ちのテーブルから、無作為（ランダム）にサンプルを抽出する（リサンプリング）、という記事。そしてそのレスポンスとして、**`{dplyr}`でこれできるよ**、という話（マエショリストさんのやりたいことと違っていたらどうしよう）。自分自身もちょっと前に得た知見なので共有のために書いておく。

```{r}
data <- data.frame(ID = seq(1, 9999))
head(data)
tail(data)
```

こうしたテーブルから、テーブルの一部を新しいテーブルとして解析を進めたい場合には、偏りをなくすために既存のテーブルからランダムにデータをとりなおす必要がある。

というわけで、みんな大好きHadleyの **`{dplyr}`** を使う。テーブルからデータをとってくる関数は`sample_n`と`sample_frac`がある。これらの関数はヘルプに書いてある通り、`base::sample`関数のラッパーとなっており、現在はローカル環境のテーブルにのみ適用される（データベースからとってきたテーブルには無理）。

```{r}
library(dplyr)
sample_n(tbl = data, size = 10)
sample_frac(tbl = data, size = 0.001)
```

`sample_n`と`sample_frac`の違いは、抽出するデータ数の指定方法である。`sample_n`では、テーブル内から取得したいデータ数を直接*size*引数に渡す。一方`sample_frac`では同じ*size*引数に渡す値は、全体のデータに対する割合を指定する。今回の場合、data数が`r nrow(data)`件であったので、そのうちの0.001割（10件分）のデータを抽出した。

この関数には*replace*や*weight*といった引数が用意されており、サンプルの方法にもこだわれるみたいだが、勉強不足なのでここでは説明できない。誰か教えて欲しい。
